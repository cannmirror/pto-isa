# 12. 后端画像与一致性

## 12.1 范围

本章定义后端能力子集的描述方式，以及一致性等级评估方法。

## 12.2 后端画像模型

后端画像 MUST 记录：

- 支持的指令族与操作形式
- 支持的 dtype/layout/location/shape 组合
- 同步与内存顺序限制
- 实现定义行为边界
- 对不支持特性的诊断策略

画像可对应具体目标（例如 A2/A3/A5/CPU 仿真器）。

## 12.3 能力门控

工具链 MUST 基于画像能力门控后端特化。
当请求行为超出画像支持时：

- 编译/合法化 MUST 确定性失败，或
- 选择显式定义的回退路径。

## 12.4 一致性维度

一致性评估维度包括：

1. 语义一致性（指令行为）
2. 合法性一致性（契约验证）
3. 顺序一致性（同步与内存可见性）
4. 诊断一致性（确定性且可执行错误）

## 12.5 一致性等级

建议等级：

- **Level 0（解析/形态）**：仅结构工具链正确性。
- **Level 1（指令族合法性）**：具备文档化指令族合法性与诊断。
- **Level 2（指令语义）**：代表性样例验证逐条语义。
- **Level 3（跨层稳定性）**：IR/字节码/后端转换后语义、顺序、诊断保持稳定。

后端 SHOULD 公布最高已验证等级及已知缺口。

## 12.6 必需测试矩阵

画像一致性套件 SHOULD 包含：

- 按指令族划分的合法/非法组合测试
- 同步与内存顺序场景测试
- 精度/模式交互测试（含混合精度路径）
- 文本/IR/字节码往返工具链测试
- 诊断稳定性快照测试

## 12.7 变更管理

后端行为变更时：

- 画像文档 MUST 在同一变更集中更新
- MUST 说明一致性影响
- 对已发布等级的回归 MUST 视为发布阻断，除非有明确豁免和理由
